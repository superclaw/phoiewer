(this.webpackJsonpphoiewer=this.webpackJsonpphoiewer||[]).push([[0],{38:function(e,t,a){e.exports=a(64)},47:function(e,t,a){},64:function(e,t,a){"use strict";a.r(t);var n,r=a(0),c=a.n(r),s=a(17),i=a.n(s),o=a(7),u=a(9),l=a(32),p=a(33),d=a(3),h=a(22),m={list:[],page:0,isLoading:!1,requestFailed:{status:!1,errorMessage:""}},b=function(e,t,a){var n=t.photo,r=Object(h.a)(e.list);return r[a]=n,Object(d.a)(Object(d.a)({},e),{},{list:r})},f=function(e,t){var a=e.list,n=e.page;return n++,Object(d.a)(Object(d.a)({},e),{},{page:n,list:[].concat(Object(h.a)(a),Object(h.a)(t)),isLoading:!1,requestFailed:Object(d.a)(Object(d.a)({},e.requestFailed),{},{status:!1})})},E=function(e,t){return Object(d.a)(Object(d.a)({},e),{},{isLoading:!1,requestFailed:Object(d.a)(Object(d.a)({},e.requestFailed),{},{status:!0,errorMessage:t})})},g=function(e){return Object(d.a)(Object(d.a)({},e),{},{isLoading:!0,requestFailed:Object(d.a)(Object(d.a)({},e.requestFailed),{},{status:!1})})},O=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:m,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"LIKE_PHOTO":return b(e,t.data,t.key);case"LOAD_NEXT":return f(e,t.data);case"IS_LOADING":return g(e);case"REQUEST_FAILED":return E(e,t.message);default:return e}},j=a(10),v=a.n(j),w={isLoggedIn:!!v.a.get("unsplash_access_token")},_=function(e){return Object(d.a)(Object(d.a)({},e),{},{isLoggedIn:!!v.a.get("unsplash_access_token")})},k=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:w,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"CHECK_AUTH":return _(e);default:return e}},L=Object(u.combineReducers)({login:k,photoList:O}),y=Object(u.createStore)(L,Object(l.composeWithDevTools)(Object(u.applyMiddleware)(p.a))),A=(a(47),a(8)),F=a(2),q=function(){return Object(o.c)((function(e){return e.login.isLoggedIn}))},T=a(34),C=a(35),I=a(19),N=a(37),x=a(36),U=a(14),D=a.n(U),H=a(24),S=a(11),P=a.n(S),G="superclaw.github.io"!==window.location.hostname,K=new P.a({accessKey:"ANOEv2G8HQvmAGeNpKS1ERxGz7-1G5f91mH8sNyo4nk",secret:"t42Xnafrq9i6jjvGmCt82qTAJ1PLW2DXQ74FOUElgAg",callbackUrl:(n=G,n?"http://superclaw.ddns.net:3000/phoiewer/build/redirect":"https://superclaw.github.io/phoiewer/build/redirect"),bearerToken:v.a.get("unsplash_access_token")}),R=K.auth.getAuthenticationUrl(["public","read_user","write_user","read_photos","write_photos","write_likes"]),J=function(e){switch(e){case 400:return"\u041a\u043e\u0434 \u0430\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u0438 \u043d\u0435\u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0442\u0435\u043b\u0435\u043d";case 401:return"\u0412\u044b \u043d\u0435 \u0430\u0432\u0442\u043e\u0440\u0438\u0437\u043e\u0432\u0430\u043d\u044b \u0438\u043b\u0438 \u0441\u0440\u043e\u043a \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u044f \u0430\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u0438 \u0438\u0441\u0442\u0451\u043a";case 403:return"\u041f\u0440\u0435\u0432\u044b\u0448\u0435\u043d \u043b\u0438\u043c\u0438\u0442 \u0437\u0430\u043f\u0440\u043e\u0441\u043e\u0432 \u043d\u0430 \u0441\u0435\u0440\u0432\u0435\u0440";case 404:return"\u0414\u0430\u043d\u043d\u044b\u0435 \u043d\u0435 \u043f\u043e\u043b\u0443\u0447\u0435\u043d\u044b";default:return"\u041d\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043d\u0430\u044f \u043e\u0448\u0438\u0431\u043a\u0430, \u043a\u043e\u0434: ".concat(e)}},M=function(e){return K.photos.likePhoto(e)},Q=function(e){return K.photos.unlikePhoto(e)},X=function(e,t){return(t?Q:M)(e).then((function(e){return e.ok?Object(S.toJson)(e).catch((function(e){return{failed:!0,message:e}})).then((function(e){return e})):{failed:!0,message:J(e.status)}}))},W=function(e){return function(){var t=Object(H.a)(D.a.mark((function t(a){var n;return D.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a({type:"IS_LOADING"}),t.next=3,r=++e,c=15,s="latest",K.photos.listPhotos(r,c,s).then((function(e){return e.ok?Object(S.toJson)(e).catch((function(e){return{failed:!0,message:e}})).then((function(e){return e})):{failed:!0,message:J(e.status)}}));case 3:(n=t.sent).failed?a({type:"REQUEST_FAILED",message:n.message}):a({type:"LOAD_NEXT",data:n});case 5:case"end":return t.stop()}var r,c,s}),t)})));return function(e){return t.apply(this,arguments)}}()},z=function(e,t,a){return function(){var n=Object(H.a)(D.a.mark((function n(r){var c;return D.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,X(e,t);case 2:(c=n.sent).failed?r({type:"REQUEST_FAILED",message:c.message}):r({type:"LIKE_PHOTO",data:c,key:a});case 4:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}()},B=function(e){var t=e.i,a=void 0===t?0:t,n=e.el,r=e.action,s=Object(o.b)(),i=n.id,u=n.likes,l=n.liked_by_user;return c.a.createElement("div",null,c.a.createElement("button",{onClick:function(){return s(r(i,l,a))}}),c.a.createElement("span",null,u))},V=function(e){Object(N.a)(a,e);var t=Object(x.a)(a);function a(e){var n;return Object(T.a)(this,a),(n=t.call(this,e)).dispatch=void 0,n.dispatch=e.dispatch.bind(Object(I.a)(n)),n}return Object(C.a)(a,[{key:"componentDidMount",value:function(){this.props.page||this.dispatch(W(0))}},{key:"render",value:function(){return this.props.requestFailed.status?c.a.createElement("p",null,"\u041e\u0448\u0438\u0431\u043a\u0430 \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0438: ",this.props.requestFailed.errorMessage):c.a.createElement("ul",null,this.props.list.map((function(e,t){return c.a.createElement("li",{key:t,className:"item"},c.a.createElement(A.b,{to:"/photo-".concat(e.id)},c.a.createElement("img",{className:"img",src:e.urls.thumb,alt:e.alt_description})),c.a.createElement(B,{i:t,el:e,action:z}))})))}}]),a}(c.a.Component),Y=function(e){var t=e.isLoading,a=e.page,n=e.dispatch;return t?c.a.createElement("div",{className:"loading-icon"},"\u0417\u0430\u0433\u0440\u0443\u0437\u043a\u0430..."):c.a.createElement("button",{className:"load-next",onClick:function(){n(W(a))}},"\u0417\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044c \u0435\u0449\u0451...")},Z=function(){var e=window.location,t=new URLSearchParams(e.search).get("redirect_to"),a=e.hash,n=Object(o.b)(),r=q(),s=Object(o.c)((function(e){return e.photoList})),i=s.page,u=s.isLoading,l=s.requestFailed,p=s.list;return t?c.a.createElement(F.a,{to:t.replace(/~and~/g,"&")+a}):r?c.a.createElement("div",{className:"wrapper"},c.a.createElement("button",{onClick:function(){return n((v.a.remove("unsplash_access_token"),{type:"CHECK_AUTH"}))}},"\u0412\u044b\u0439\u0442\u0438"),c.a.createElement(V,{list:p,requestFailed:l,page:i,dispatch:n}),c.a.createElement(Y,{isLoading:u,page:i,dispatch:n})):c.a.createElement(F.a,{to:"/auth"})},$=function(){var e=Object(F.g)().id;return c.a.createElement("div",null,e)},ee=function(){return q()?c.a.createElement(F.a,{to:"/"}):c.a.createElement("div",null,c.a.createElement("p",null,"\u0414\u043b\u044f \u043f\u0440\u043e\u0441\u043c\u043e\u0442\u0440\u0430 \u044d\u0442\u043e\u0439 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u044b \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e \u0430\u0432\u0442\u043e\u0440\u0438\u0437\u043e\u0432\u0430\u0442\u044c\u0441\u044f."),c.a.createElement("button",{onClick:function(){return window.location.replace(R)}},"\u0412\u043e\u0439\u0442\u0438"))},te=function(){var e=Object(o.b)(),t=window.location,a=t.protocol+"//"+t.hostname+(t.port?":"+t.port:"")+t.pathname.replace("/redirect","/"),n=new URLSearchParams(t.search).get("code");return n?(K.auth.userAuthentication(n).then((function(n){return n.ok||(alert("\u041e\u0448\u0438\u0431\u043a\u0430: ".concat(J(n.status))),t.replace(a)),Object(S.toJson)(n).catch((function(e){alert("\u041e\u0448\u0438\u0431\u043a\u0430: ".concat(e)),t.replace(a)})).then((function(n){var r;n.access_token&&e((r=n.access_token,v.a.set("unsplash_access_token",r),{type:"CHECK_AUTH"})),t.replace(a)}))})),c.a.createElement("div",null,"\u0418\u0434\u0451\u0442 \u0430\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u044f...")):c.a.createElement(F.a,{to:"/"})},ae=function(){return c.a.createElement(A.a,{basename:"/phoiewer/build/"},c.a.createElement(F.d,null,c.a.createElement(F.b,{exact:!0,path:"/photo-:id"},c.a.createElement($,null)),c.a.createElement(F.b,{exact:!0,path:"/auth"},c.a.createElement(ee,null)),c.a.createElement(F.b,{exact:!0,path:"/redirect"},c.a.createElement(te,null)),c.a.createElement(F.b,{exact:!0,path:"/"},c.a.createElement(Z,null))))};i.a.render(c.a.createElement(o.a,{store:y},c.a.createElement(ae,null)),document.querySelector("#root"))}},[[38,1,2]]]);
//# sourceMappingURL=main.310c7196.chunk.js.map
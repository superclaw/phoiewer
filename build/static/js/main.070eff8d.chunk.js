(this.webpackJsonpphoiewer=this.webpackJsonpphoiewer||[]).push([[0],{38:function(e,t,a){e.exports=a(64)},47:function(e,t,a){},64:function(e,t,a){"use strict";a.r(t);var n,r=a(0),c=a.n(r),s=a(18),o=a.n(s),u=a(4),i=a(10),l=a(32),p=a(33),d=a(2),m=a(11),h=a.n(m),f={isLoggedIn:!!h.a.get("unsplash_access_token")},b=function(e){return Object(d.a)(Object(d.a)({},e),{},{isLoggedIn:!!h.a.get("unsplash_access_token")})},E=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:f,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"CHECK_AUTH":return b(e);default:return e}},g=a(23),O={list:[],page:0,isLoading:!1,requestFailed:{status:!1,errorMessage:""}},v=function(e,t,a){var n=t.photo,r=Object(g.a)(e.list);return r[a].likes=n.likes,r[a].liked_by_user=n.liked_by_user,Object(d.a)(Object(d.a)({},e),{},{list:r})},j=function(e,t){var a=e.list,n=e.page;return n++,Object(d.a)(Object(d.a)({},e),{},{page:n,list:[].concat(Object(g.a)(a),Object(g.a)(t)),isLoading:!1,requestFailed:Object(d.a)(Object(d.a)({},e.requestFailed),{},{status:!1})})},_=function(e,t){return Object(d.a)(Object(d.a)({},e),{},{isLoading:!1,requestFailed:Object(d.a)(Object(d.a)({},e.requestFailed),{},{status:!0,errorMessage:t})})},k=function(e){return Object(d.a)(Object(d.a)({},e),{},{isLoading:!0,requestFailed:Object(d.a)(Object(d.a)({},e.requestFailed),{},{status:!1})})},w=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:O,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"LIKE_PHOTO":return v(e,t.data,t.key);case"LOAD_NEXT":return j(e,t.data);case"IS_LOADING":return k(e);case"REQUEST_FAILED":return _(e,t.message);default:return e}},y={requestFailed:{status:!1,errorMessage:""}},L=function(e){return Object(d.a)(Object(d.a)({},e),{},{photo:void 0,requestFailed:{status:!1,errorMessage:""}})},A=function(e,t){return Object(d.a)(Object(d.a)({},e),{},{photo:t})},F=function(e,t){var a=t.photo,n=Object(d.a)({},e);return n.photo&&(n.photo.likes=a.likes,n.photo.liked_by_user=a.liked_by_user),n},T=function(e,t){return Object(d.a)(Object(d.a)({},e),{},{requestFailed:Object(d.a)(Object(d.a)({},e.requestFailed),{},{status:!0,errorMessage:t})})},q=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:y,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"CLEAR_DATA":return L(e);case"LOAD_PHOTO":return A(e,t.data);case"LIKE_PHOTO":return F(e,t.data);case"REQUEST_FAILED":return T(e,t.message);default:return e}},D=Object(i.combineReducers)({login:E,photoList:w,details:q}),I=Object(i.createStore)(D,Object(l.composeWithDevTools)(Object(i.applyMiddleware)(p.a))),x=(a(47),a(9)),C=a(3),U=function(){return Object(u.c)((function(e){return e.login.isLoggedIn}))},H=a(8),S=a.n(H),P=a(14),R=a(12),N=a.n(R),K="superclaw.github.io"!==window.location.hostname,M=new N.a({accessKey:"ANOEv2G8HQvmAGeNpKS1ERxGz7-1G5f91mH8sNyo4nk",secret:"t42Xnafrq9i6jjvGmCt82qTAJ1PLW2DXQ74FOUElgAg",callbackUrl:(n=K,n?"http://superclaw.ddns.net:3000/phoiewer/build/redirect":"https://superclaw.github.io/phoiewer/build/redirect"),bearerToken:h.a.get("unsplash_access_token")}),Q=M.auth.getAuthenticationUrl(["public","read_user","write_user","read_photos","write_photos","write_likes"]),G=function(e){switch(e){case 400:return"\u041a\u043e\u0434 \u0430\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u0438 \u043d\u0435\u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0442\u0435\u043b\u0435\u043d";case 401:return"\u0412\u044b \u043d\u0435 \u0430\u0432\u0442\u043e\u0440\u0438\u0437\u043e\u0432\u0430\u043d\u044b \u0438\u043b\u0438 \u0441\u0440\u043e\u043a \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u044f \u0430\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u0438 \u0438\u0441\u0442\u0451\u043a";case 403:return"\u041f\u0440\u0435\u0432\u044b\u0448\u0435\u043d \u043b\u0438\u043c\u0438\u0442 \u0437\u0430\u043f\u0440\u043e\u0441\u043e\u0432 \u043d\u0430 \u0441\u0435\u0440\u0432\u0435\u0440";case 404:return"\u041d\u0435 \u0443\u0434\u0430\u043b\u043e\u0441\u044c \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u0434\u0430\u043d\u043d\u044b\u0435 \u043f\u043e \u0437\u0430\u043f\u0440\u043e\u0441\u0443";default:return"\u041d\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043d\u0430\u044f \u043e\u0448\u0438\u0431\u043a\u0430, \u043a\u043e\u0434: ".concat(e)}},J=function(e){return M.photos.likePhoto(e)},X=function(e){return M.photos.unlikePhoto(e)},W=function(e,t){return(t?X:J)(e).then((function(e){return e.ok?Object(R.toJson)(e).catch((function(e){return{failed:!0,message:e}})).then((function(e){return e})):{failed:!0,message:G(e.status)}}))},z=function(e){return M.photos.getPhoto(e).then((function(e){return e.ok?Object(R.toJson)(e).catch((function(e){return{failed:!0,message:e}})).then((function(e){return e})):{failed:!0,message:G(e.status)}}))},B=function(e){return function(){var t=Object(P.a)(S.a.mark((function t(a){var n;return S.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a({type:"IS_LOADING"}),t.next=3,r=++e,c=15,s="latest",M.photos.listPhotos(r,c,s).then((function(e){return e.ok?Object(R.toJson)(e).catch((function(e){return{failed:!0,message:e}})).then((function(e){return e})):{failed:!0,message:G(e.status)}}));case 3:(n=t.sent).failed?a({type:"REQUEST_FAILED",message:n.message}):a({type:"LOAD_NEXT",data:n});case 5:case"end":return t.stop()}var r,c,s}),t)})));return function(e){return t.apply(this,arguments)}}()},V=function(e,t,a){return function(){var n=Object(P.a)(S.a.mark((function n(r){var c;return S.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,W(e,t);case 2:(c=n.sent).failed?r({type:"REQUEST_FAILED",message:c.message}):r({type:"LIKE_PHOTO",data:c,key:a});case 4:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}()},Y=a(34),Z=a(35),$=a(20),ee=a(37),te=a(36),ae=function(e){var t=e.el;return c.a.createElement(x.b,{to:"/photo-".concat(t.id)},c.a.createElement("img",{className:"img",src:t.urls.small,alt:t.alt_description}))},ne=function(e){var t=e.user;return c.a.createElement("a",{href:"https://unsplash.com/@".concat(t.username),target:"__blank"},c.a.createElement("img",{src:t.profile_image.small,alt:t.name}),c.a.createElement("span",null,t.name))},re=function(e){var t=e.i,a=void 0===t?0:t,n=e.el,r=e.action,s=Object(u.b)(),o=n.id,i=n.likes,l=n.liked_by_user;return c.a.createElement("div",null,c.a.createElement("button",{onClick:function(){return s(r(o,l,a))}}),c.a.createElement("span",null,i))},ce=function(e){var t=e.date,a=e.short,n=new Date(t),r=a?{day:"numeric",month:"2-digit",year:"2-digit"}:{day:"numeric",month:"long",year:"numeric"};return c.a.createElement("time",{dateTime:t},n.toLocaleDateString("ru-RU",r))},se=function(e){Object(ee.a)(a,e);var t=Object(te.a)(a);function a(e){var n;return Object(Y.a)(this,a),(n=t.call(this,e)).action=void 0,n.action=e.action.bind(Object($.a)(n)),n}return Object(Z.a)(a,[{key:"componentDidMount",value:function(){this.props.page||this.action(0)}},{key:"render",value:function(){return this.props.requestFailed.status?c.a.createElement("p",null,"\u041e\u0448\u0438\u0431\u043a\u0430 \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0438: ",this.props.requestFailed.errorMessage):c.a.createElement("ul",null,this.props.list.map((function(e,t){return c.a.createElement("li",{key:t},c.a.createElement("div",null,c.a.createElement(ne,{user:e.user}),c.a.createElement(re,{i:t,el:e,action:V})),c.a.createElement(ae,{el:e}),c.a.createElement("div",null,c.a.createElement(ce,{date:e.created_at,short:!0})))})))}}]),a}(c.a.Component),oe=function(e){var t=e.page,a=Object(u.b)();return c.a.createElement("button",{className:"load-next",onClick:function(){a(B(t))}},"\u0417\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044c \u0435\u0449\u0451...")},ue=function(){var e=window.location,t=new URLSearchParams(e.search).get("redirect_to"),a=e.hash,n=Object(u.b)(),r=U(),s=Object(u.c)((function(e){return e.photoList})),o=s.page,i=s.isLoading,l=s.requestFailed,p=s.list;return t?c.a.createElement(C.a,{to:t.replace(/~and~/g,"&")+a}):r?c.a.createElement("div",{className:"wrapper"},c.a.createElement("button",{onClick:function(){return n((h.a.remove("unsplash_access_token"),{type:"CHECK_AUTH"}))}},"\u0412\u044b\u0439\u0442\u0438"),c.a.createElement(se,{list:p,requestFailed:l,page:o,action:function(e){return n(B(e))}}),i?c.a.createElement("div",{className:"loading-icon"},"\u0417\u0430\u0433\u0440\u0443\u0437\u043a\u0430..."):c.a.createElement(oe,{page:o})):c.a.createElement(C.a,{to:"/auth"})},ie=function(e,t){return function(){var a=Object(P.a)(S.a.mark((function a(n){var r;return S.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,W(e,t);case 2:(r=a.sent).failed?n({type:"REQUEST_FAILED",message:r.message}):n({type:"LIKE_PHOTO",data:r});case 4:case"end":return a.stop()}}),a)})));return function(e){return a.apply(this,arguments)}}()},le=function(e){var t=e.photo;return t?c.a.createElement("div",null,c.a.createElement("img",{src:t.urls.full,alt:t.alt_description})):c.a.createElement("div",null,"\u0417\u0430\u0433\u0440\u0443\u0437\u043a\u0430...")},pe=function(){var e=Object(C.h)().id,t=Object(C.g)(),a=Object(u.c)((function(e){return e.details})),n=Object(u.b)(),r=a.photo,s=a.requestFailed;return r||s.status?r&&r.id!==e&&n({type:"CLEAR_DATA"}):n(function(e){return function(){var t=Object(P.a)(S.a.mark((function t(a){var n;return S.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,z(e);case 2:(n=t.sent).failed?a({type:"REQUEST_FAILED",message:n.message}):a({type:"LOAD_PHOTO",data:n});case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}(e)),c.a.createElement("div",null,c.a.createElement("button",{onClick:t.goBack},"\u041d\u0430\u0437\u0430\u0434"),s.status?c.a.createElement("div",null,"\u041e\u0448\u0438\u0431\u043a\u0430 \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0438 \u0444\u043e\u0442\u043e\u0433\u0440\u0430\u0444\u0438\u0438: ",s.errorMessage):c.a.createElement(le,{photo:r}),r&&c.a.createElement("div",null,c.a.createElement(ne,{user:r.user}),c.a.createElement("span",null,"\u0414\u0430\u0442\u0430 \u043f\u0443\u0431\u043b\u0438\u043a\u0430\u0446\u0438\u0438: ",c.a.createElement(ce,{date:r.created_at,short:!1})),c.a.createElement(re,{el:r,action:ie})))},de=function(){return U()?c.a.createElement(C.a,{to:"/"}):c.a.createElement("div",null,c.a.createElement("p",null,"\u0414\u043b\u044f \u043f\u0440\u043e\u0441\u043c\u043e\u0442\u0440\u0430 \u044d\u0442\u043e\u0439 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u044b \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e \u0430\u0432\u0442\u043e\u0440\u0438\u0437\u043e\u0432\u0430\u0442\u044c\u0441\u044f."),c.a.createElement("button",{onClick:function(){return window.location.replace(Q)}},"\u0412\u043e\u0439\u0442\u0438"))},me=function(){var e=Object(u.b)(),t=window.location,a=t.protocol+"//"+t.hostname+(t.port?":"+t.port:"")+t.pathname.replace("/redirect","/"),n=new URLSearchParams(t.search).get("code");return n?(M.auth.userAuthentication(n).then((function(n){return n.ok||(alert("\u041e\u0448\u0438\u0431\u043a\u0430: ".concat(G(n.status))),t.replace(a)),Object(R.toJson)(n).catch((function(e){alert("\u041e\u0448\u0438\u0431\u043a\u0430: ".concat(e)),t.replace(a)})).then((function(n){var r;n.access_token&&e((r=n.access_token,h.a.set("unsplash_access_token",r),{type:"CHECK_AUTH"})),t.replace(a)}))})),c.a.createElement("div",null,"\u0418\u0434\u0451\u0442 \u0430\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u044f...")):c.a.createElement(C.a,{to:"/"})},he=function(){return c.a.createElement(x.a,{basename:"/phoiewer/build/"},c.a.createElement(C.d,null,c.a.createElement(C.b,{exact:!0,path:"/photo-:id"},c.a.createElement(pe,null)),c.a.createElement(C.b,{exact:!0,path:"/auth"},c.a.createElement(de,null)),c.a.createElement(C.b,{exact:!0,path:"/redirect"},c.a.createElement(me,null)),c.a.createElement(C.b,{exact:!0,path:"/"},c.a.createElement(ue,null))))};o.a.render(c.a.createElement(u.a,{store:I},c.a.createElement(he,null)),document.querySelector("#root"))}},[[38,1,2]]]);
//# sourceMappingURL=main.070eff8d.chunk.js.map